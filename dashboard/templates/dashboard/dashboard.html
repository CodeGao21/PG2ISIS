{% extends 'core/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="max-w-screen-lg mx-auto p-4">

    <!-- Dashboard Header -->
    <div class="text-center mb-8">
        <h1 class="text-2xl font-bold">Dashboard</h1>
    </div>

    <!-- KPI Cards Container -->
    <div class="grid md:grid-cols-2 gap-4 mb-8">
        <!-- KPI Card - Occupancy Percentage -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Porcentaje de Ocupación</h2>
            <p class="text-4xl font-bold text-blue-500">{{ occupancy_percentage }}%</p>
            <p class="text-sm text-gray-500">Total Propiedades: {{ total_properties }} | Propiedades Ocupadas: {{ occupied_properties }}</p>
        </div>

        <!-- KPI Card - Total Rented Area -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Metros Cuadrados Rentados</h2>
            <p class="text-4xl font-bold text-orange-500">{{ total_rented_area }} m²</p>
            <p class="text-sm text-gray-500">Suma del área de todas las propiedades ocupadas.</p>
        </div>

        <!-- KPI Card - Total Rent Income -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Ingresos por Alquiler</h2>
            <p class="text-4xl font-bold text-purple-500">${{ total_rent_income }}</p>
            <p class="text-sm text-gray-500">Suma del precio de alquiler de todas las propiedades ocupadas.</p>
        </div>

        <!-- KPI Card - Average Lease Duration -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Duración Promedio de Contrato</h2>
            <p class="text-4xl font-bold text-green-500">{{ average_duration_in_days }} años</p>
            <p class="text-sm text-gray-500">Promedio calculado de la duración de contratos de propiedades ocupadas.</p>
        </div>
    </div>

    <h2 class="text-lg font-semibold mb-4 pl-4">Estadísticas Leads del Mes</h2>

    <!-- Lead Status Cards -->
    <div class="grid grid-cols-3 gap-4">
        {% for lead_status in lead_status_counts %}
            <div class="bg-white p-6 rounded-lg shadow-md mb-4">
                <h2 class="text-lg font-semibold mb-4">{{ lead_status.status }}</h2>
                <p class="text-4xl font-bold text-gray-500">{{ lead_status.count }}</p>
            </div>
        {% endfor %}
    </div>

        <!-- Lead States Cards -->
        <div class="grid md:grid-cols-3 gap-4">
            {% for lead_state in lead_state_counts %}
                <div class="bg-white p-6 rounded-lg shadow-md mb-4">
                    <h2 class="text-lg font-semibold mb-4">{{ lead_state.state }}</h2>
                    <p class="text-4xl font-bold text-gray-500">{{ lead_state.count }}</p>
                </div>
            {% endfor %}
        </div>

    <!-- Rankings Container -->
    <div class="grid md:grid-cols-2 gap-4">
        <!-- Brokers Ranking -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Ranking de Brokers del Mes</h2>
            <ul>
                {% for broker_ranking in brokers_ranking %}
                    <li class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <span class="text-3xl font-semibold text-blue-900 mr-2">{{ broker_ranking.broker_name }}</span>
                            <span class="text-gray-500">{{ broker_ranking.count }} Leads</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-2xl text-blue-900 mr-2">{{ forloop.counter }}</span>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Fuente Ranking -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Ranking de Fuentes de Leads del Mes</h2>
            <ul>
                {% for fuente_ranking in fuente_ranking %}
                    <li class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <!-- Display 'fuente_name' or a default value if 'fuente_name' is None or empty -->
                            <span class="text-3xl font-semibold text-blue-900 mr-2">{{ fuente_ranking.fuente_name|default:"Otro" }}</span>
                            <span class="text-gray-500">{{ fuente_ranking.count }} Leads</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-2xl text-blue-900 mr-2">{{ forloop.counter }}</span>
                        </div>
                    </li>
                {% empty %}
                    <li>No hay datos disponibles para este mes.</li>
                {% endfor %}
            </ul>
        </div>

    </div>

        <!-- Processes Ranking -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">Ranking de Tiempo del Mes</h2>
            <ul>
                
                {% for process in processes_ranking %}
                    <li class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <span class="text-2xl text-red-900 mr-2">{{ forloop.counter }}</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-3xl font-semibold text-red-900 mr-2">{{ process.name }}</span>
                            <span class="text-gray-500 mr-2">{{ process.prop__name }}</span>
                            <span class="text-gray-500">{{ process.total_time }} days</span>
                        </div>
                    </li>
                {% endfor %}


            </ul>
        </div>

        <!-- KPI Card - Average Duration for "Búsqueda Cliente" Stage -->
<div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-lg font-semibold mb-4">Duración Promedio de Búsqueda Cliente</h2>
    <p class="text-4xl font-bold text-yellow-500">{{ average_search_client_duration }} días</p>
    <p class="text-sm text-gray-500">Promedio de duración de los procesos en la etapa de búsqueda de cliente.</p>
</div>

</div>
{% endblock %}

