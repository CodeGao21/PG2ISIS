{% extends 'core/base.html' %}

{% block title %}Modificar Actividad{% endblock %}

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

{% block content %}
<div class="mt-8 bg-white p-8 rounded-xl shadow-lg max-w-md mx-auto pt-4 border border-blue-900">
    <h1 class="text-3xl text-blue-900 mb-6">Modificar Actividad</h1>

    <form method="post" action=".">
        {% csrf_token %}

        <div class="mb-4">
            <label for="name" class="block text-sm font-bold text-gray-700 mb-2">Nombre</label>
            <input type="text" id="name" name="name" class="w-full p-2 border border-gray-300 rounded" value="{{ form.instance.name }}" required>
        </div>

        <div class="mb-4">
            <label for="prop" class="block text-sm font-bold text-gray-700 mb-2">Propiedad</label>
            <select id="prop" name="prop" class="w-full p-2 border border-gray-300 rounded">
                <option value="">---------</option>
                {% for property in properties %}
                    <option value="{{ property.id }}" {% if form.instance.prop == property %}selected{% endif %}>{{ property.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-4">
            <label for="stage" class="block text-sm font-bold text-gray-700 mb-2">Proceso</label>
            <input type="text" id="stage" name="stage" class="w-full p-2 border border-gray-300 rounded" value="{{ form.instance.stage }}">
        </div>

        <div class="mb-4">
            <label for="description" class="block text-sm font-bold text-gray-700 mb-2">Descripci√≥n</label>
            <textarea id="description" name="description" class="w-full p-2 border border-gray-300 rounded">{{ form.instance.description }}</textarea>
        </div>

        <!-- On Progress -->
        <div class="mb-4">
            <label for="OnProgress" class="block text-sm font-bold text-gray-700 mb-2">En Progreso</label>
            <input type="checkbox" id="OnProgress" name="OnProgress" class="mr-2" {% if form.instance.OnProgress %}checked{% endif %}>
            <!-- Debugging output -->
            {{ form.instance.OnProgress }}
        </div>


        <!-- Start Date -->
        <div class="mb-4">
            <label for="start_date" class="block text-sm font-bold text-gray-700 mb-2">Inicio </label>
            <input type="date" id="start_date" name="start_date" class="w-full p-2 border border-gray-300 rounded" value="{% if form.instance.start_date %}{{ form.instance.start_date|date:'Y-m-d' }}{% endif %}" required>
        </div>

        <!-- End Date (conditionally displayed) -->
        <div id="endDateField" class="mb-4" style="display: {% if process.OnProgress %}none{% else %}block{% endif %};">
            <label for="end_date" class="block text-sm font-bold text-gray-700 mb-2">Fin </label>
            <input type="date" id="end_date" name="end_date" class="w-full p-2 border border-gray-300 rounded" value="{% if form.instance.end_date %}{{ form.instance.end_date|date:'Y-m-d' }}{% endif %}">
        </div>

        <div class="flex items-center justify-center mt-4">
            <button class="py-2 px-4 bg-blue-900 hover:bg-blue-700 text-sm text-white rounded-full" type="submit">Modificar</button>
        </div>
    </form>
</div>

<script>
    // Add JavaScript to toggle the display of the End Date field based on the On Progress checkbox
    document.addEventListener('DOMContentLoaded', function () {
        var onProgressCheckbox = document.getElementById('OnProgress');
        var endDateField = document.getElementById('endDateField');

        onProgressCheckbox.addEventListener('change', function () {
            if (onProgressCheckbox.checked) {
                // On Progress is checked, hide the End Date field
                endDateField.style.display = 'none';
            } else {
                // On Progress is unchecked, show the End Date field
                endDateField.style.display = 'block';
            }
        });

        // Trigger the change event initially to set the initial state
        onProgressCheckbox.dispatchEvent(new Event('change'));
    });
</script>

{% endblock %}
